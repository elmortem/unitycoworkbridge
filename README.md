# Unity Cowork Bridge

Система для выполнения AI-генерируемых C# скриптов в открытом Unity Editor через Claude Cowork. Cowork пишет скрипты, Bridge компилирует и запускает их внутри Unity, возвращает результаты и ошибки. При ошибках компиляции Cowork автоматически исправляет код и пробует снова.

## Как это работает

Система состоит из двух частей:

**Cowork Bridge** — C# пакет внутри Unity Editor. Следит за папкой `Assets/Editor/CoworkBridge/`, подхватывает файлы задач, компилирует скрипты, выполняет их через reflection и записывает результаты.

**Unity Bridge Plugin** — плагин для Claude Cowork. Содержит инструкции для Claude по генерации скриптов, протокол взаимодействия с Bridge и логику обработки ошибок.

Задачей является сам `.cs` скрипт — достаточно положить его в `Assets/Editor/CoworkBridge/`, и Bridge подхватит. Никаких дополнительных JSON-файлов задач не нужно. Несколько агентов или пользователей могут создавать скрипты независимо — Bridge обрабатывает их последовательно в порядке создания.

## Установка Unity Bridge

1. Скопируйте папку `Assets/CoworkBridge/` в ваш Unity проект
2. Добавьте `Assets/Editor/CoworkBridge/` в `.gitignore` проекта

Готово. Пакет не имеет зависимостей от других сборок проекта и будет работать даже если в проекте есть ошибки компиляции.

## Установка Cowork Plugin

### Требования

Cowork доступен только в десктопном приложении Claude (macOS и Windows). Веб-версия и мобильные приложения не поддерживают Cowork и плагины.

### Вариант 1: Через Claude Code CLI

Если у вас установлен Claude Code, можно загрузить плагин напрямую из локальной папки:

```bash
claude --plugin-dir /путь/к/unity-bridge-plugin
```

Для постоянной установки создайте свой marketplace или используйте флаг `--plugin-dir` при каждом запуске.

### Вариант 2: Через интерфейс Cowork

1. Откройте Claude Desktop и перейдите на вкладку **Cowork**
2. В боковой панели нажмите **Customize**
3. Нажмите **Browse plugins** → загрузите папку `unity-bridge-plugin/` или `.plugin` архив

### Вариант 3: Через локальный marketplace

Если вы хотите распространить плагин внутри команды:

1. Создайте marketplace — папку с файлом `.claude-plugin/marketplace.json`, содержащим список плагинов
2. Добавьте marketplace в Claude Code: `/plugin marketplace add /путь/к/marketplace`
3. Установите плагин: `/plugin install unity-bridge@имя-marketplace`

### Структура плагина

```
unity-bridge-plugin/
├── .claude-plugin/
│   └── plugin.json          ← манифест плагина
├── commands/
│   └── unity-run.md         ← команда /unity:run
├── skills/
│   └── unity-bridge/
│       └── SKILL.md         ← инструкции для Claude
└── scripts/
    └── wait_result.sh       ← скрипт ожидания результата
```

### Проверка установки

После установки в Cowork должна быть доступна команда `/unity:run`. Введите её в чат — если плагин установлен корректно, Claude начнёт генерацию скрипта.

## Использование

### Запуск Bridge

В Unity Editor откройте меню **Tools → Cowork Bridge → Start**. Bridge начнёт следить за папкой `Assets/Editor/CoworkBridge/`.

### Остановка Bridge

**Tools → Cowork Bridge → Stop**

### Выполнение задач через Cowork

Используйте команду `/unity:run` с описанием задачи на естественном языке:

```
/unity:run добавь компонент Rigidbody на все объекты с тегом Enemy
```

Claude сгенерирует скрипт, отправит его в Bridge, дождётся результата и покажет что получилось. Если будут ошибки компиляции — автоматически исправит и попробует снова (до 3 раз).

### Ручной запуск задач

Можно создать скрипт вручную и запустить через **Tools → Cowork Bridge → Run Task...** (файловый диалог для выбора .cs файла).

Скрипт должен следовать шаблону:

```csharp
using UnityEngine;
using UnityEditor;

public static class Task_20260226_143052
{
    public static string Run()
    {
        // ваш код
        return "описание результата";
    }
}
```

### Очистка задач

- **Tools → Cowork Bridge → Clean Completed** — удаляет завершённые задачи (скрипт + результат + маркер)
- **Tools → Cowork Bridge → Clean All** — удаляет все задачи

## Кастомные API проекта

Если в проекте есть кастомные API (свои библиотеки, тулзы, билдеры), их можно описать для Bridge, чтобы Claude использовал их при генерации скриптов. Для этого создайте файл `UNITYCOWORK.md` рядом с кодом библиотеки.

При выполнении задачи скилл ищет все файлы `UNITYCOWORK.md` в проекте рекурсивно и читает их. Если описанный API подходит для задачи — Claude использует его вместо стандартного Unity Editor API.

Формат файла:

```markdown
# Название API

Краткое описание: что делает и когда использовать.

## Когда использовать

Описание задач, для которых применяется этот API.

## Namespace / Using

Какие using нужно добавить.

## Основные классы и методы

Публичный API с примерами.

## Примеры

Готовые примеры для типичных сценариев.
```

Подробный шаблон с рекомендациями: `Docs/UNITYCOWORK-template.md`

Для стандартного Unity Editor API отдельная документация не нужна — Claude знает его из коробки.

## Рабочая директория

```
Assets/Editor/CoworkBridge/
├── Task_XXX.cs                 ← сгенерированные скрипты = задачи
├── result_<id>.json            ← результаты выполнения
└── result_<id>.done            ← маркеры готовности результатов
```

## Ограничения

- Работает только в Unity Editor, не в Play Mode
- Задачи обрабатываются последовательно
- Метод `Run()` выполняется на main thread Unity — длительные операции могут подвесить Editor
- Генерируемые скрипты не должны зависеть от сборок с ошибками компиляции
